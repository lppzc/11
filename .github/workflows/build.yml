# .github/workflows/build.yml
name: Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-20.04, windows-2019, macos-10.15]
        qt_version: [5.15.2]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Install Qt
      uses: jurplel/install-qt-action@v3
      with:
        version: ${{ matrix.qt_version }}
        host: ${{ runner.os }}
        target: desktop
        arch: ${{ matrix.arch }}
        
    - name: Setup build environment (Linux)
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        sudo apt-get install -y libgl1-mesa-dev libxcb-xtest0-dev libxcb-xinerama0-dev
        
    - name: Configure project (Windows/Linux)
      if: runner.os != 'macOS'
      run: qmake -config release todolist.pro
      
    - name: Configure project (macOS)
      if: runner.os == 'macOS'
      run: |
        export PATH="/usr/local/opt/qt5/bin:$PATH"
        qmake -config release todolist.pro
        
    - name: Build project (Windows)
      if: runner.os == 'Windows'
      run: nmake
      
    - name: Build project (Linux/macOS)
      if: runner.os != 'Windows'
      run: make
      
    - name: Upload artifacts (Windows)
      if: runner.os == 'Windows'
      uses: actions/upload-artifact@v3
      with:
        name: todolist-windows
        path: release/todolist.exe
        
    - name: Upload artifacts (Linux)
      if: runner.os == 'Linux'
      uses: actions/upload-artifact@v3
      with:
        name: todolist-linux
        path: todolist
        
    - name: Upload artifacts (macOS)
      if: runner.os == 'macOS'
      uses: actions/upload-artifact@v3
      with:
        name: todolist-macos
        path: todolist.app
